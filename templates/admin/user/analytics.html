{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Anal√≠ticas de Usuarios - {{ site_title }}{% endblock %}

{% block extrastyle %}
<style>
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 14px;
        font-weight: normal;
        text-transform: uppercase;
    }
    
    .stat-number {
        font-size: 36px;
        font-weight: bold;
        color: #333;
        margin: 10px 0;
    }
    
    .stat-card.green .stat-number { color: #28a745; }
    .stat-card.blue .stat-number { color: #007bff; }
    .stat-card.yellow .stat-number { color: #ffc107; }
    .stat-card.red .stat-number { color: #dc3545; }
    
    .chart-container {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
    }
    
    .providers-list {
        list-style: none;
        padding: 0;
        margin: 20px 0;
    }
    
    .providers-list li {
        padding: 10px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .provider-badge {
        padding: 5px 10px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        font-size: 12px;
    }
    
    .progress-bar {
        height: 20px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        margin: 5px 0;
    }
    
    .progress-fill {
        height: 100%;
        background: #007bff;
        transition: width 0.3s;
    }
</style>
{% endblock %}

{% block content %}
<h1>üìä Anal√≠ticas de Usuarios</h1>

<div class="dashboard-stats">
    <div class="stat-card blue">
        <h3>Total de Usuarios</h3>
        <div class="stat-number">{{ total_users }}</div>
        <p>Usuarios registrados</p>
    </div>
    
    <div class="stat-card green">
        <h3>Usuarios Verificados</h3>
        <div class="stat-number">{{ verified_users }}</div>
        <p>{{ verified_users }} de {{ total_users }}</p>
    </div>
    
    <div class="stat-card yellow">
        <h3>Usuarios Activos</h3>
        <div class="stat-number">{{ active_users }}</div>
        <p>Cuentas activas</p>
    </div>
    
    <div class="stat-card">
        <h3>Staff</h3>
        <div class="stat-number">{{ staff_users }}</div>
        <p>Usuarios con permisos</p>
    </div>
</div>

<div class="dashboard-stats">
    <div class="stat-card green">
        <h3>üîê Con 2FA</h3>
        <div class="stat-number">{{ users_with_2fa }}</div>
        <p>Seguridad activada</p>
    </div>
    
    <div class="stat-card blue">
        <h3>Nuevos (7 d√≠as)</h3>
        <div class="stat-number">{{ new_users_this_week }}</div>
        <p>Registros recientes</p>
    </div>
    
    <div class="stat-card green">
        <h3>Logins Recientes</h3>
        <div class="stat-number">{{ recent_logins }}</div>
        <p>√öltimos 7 d√≠as</p>
    </div>
    
    <div class="stat-card red">
        <h3>Logins Fallidos</h3>
        <div class="stat-number">{{ failed_logins }}</div>
        <p>√öltimos 7 d√≠as</p>
    </div>
</div>

<div class="chart-container">
    <h2>Usuarios por M√©todo de Autenticaci√≥n</h2>
    <ul class="providers-list">
        {% for provider in users_by_provider %}
        <li>
            <div>
                <span class="provider-badge" style="background-color: 
                    {% if provider.provider == 'email' %}#6c757d
                    {% elif provider.provider == 'google' %}#4285f4
                    {% elif provider.provider == 'facebook' %}#1877f2
                    {% elif provider.provider == 'github' %}#333
                    {% endif %}">
                    {{ provider.provider|upper }}
                </span>
                <strong>{{ provider.count }}</strong> usuario(s)
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<div class="chart-container">
    <h2>Registros por Mes (√∫ltimos 6 meses)</h2>
    <ul class="providers-list">
        {% for reg in registrations_by_month %}
        <li>
            <div>
                <strong>{{ reg.month }}</strong>
                <span style="margin-left: 20px;">{{ reg.count }} usuario(s)</span>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<div style="margin: 30px 0;">
    <a href="{% url 'admin:user_useraccount_changelist' %}" class="button">‚Üê Volver a Usuarios</a>
</div>

{% endblock %}