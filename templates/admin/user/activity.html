{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Actividad de {{ user.email }} - {{ site_title }}{% endblock %}

{% block extrastyle %}
<style>
    .user-header {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .user-info h2 {
        margin: 0 0 10px 0;
    }
    
    .user-badges {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .badge {
        padding: 5px 10px;
        border-radius: 5px;
        color: white;
        font-size: 12px;
        font-weight: bold;
    }
    
    .badge.green { background: #28a745; }
    .badge.blue { background: #007bff; }
    .badge.yellow { background: #ffc107; color: #333; }
    .badge.red { background: #dc3545; }
    .badge.gray { background: #6c757d; }
    
    .activity-log {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin: 20px 0;
    }
    
    .log-entry {
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: grid;
        grid-template-columns: 50px 150px 1fr 150px;
        gap: 15px;
        align-items: center;
    }
    
    .log-entry:last-child {
        border-bottom: none;
    }
    
    .log-entry:hover {
        background: #f8f9fa;
    }
    
    .log-icon {
        font-size: 24px;
        text-align: center;
    }
    
    .log-icon.success { color: #28a745; }
    .log-icon.failed { color: #dc3545; }
    
    .log-event {
        font-weight: bold;
        text-transform: capitalize;
    }
    
    .log-details {
        color: #666;
        font-size: 13px;
    }
    
    .log-time {
        text-align: right;
        color: #999;
        font-size: 13px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .stat-box {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
    }
    
    .stat-box .number {
        font-size: 28px;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .stat-box .label {
        color: #666;
        font-size: 13px;
    }
</style>
{% endblock %}

{% block content %}
<h1>üë§ Actividad del Usuario</h1>

<div class="user-header">
    <div class="user-info">
        <h2>{{ user.email }}</h2>
        <p style="margin: 5px 0;">
            <strong>Nombre:</strong> {{ user.first_name }} {{ user.last_name }}<br>
            <strong>ID:</strong> {{ user.id }}<br>
            <strong>Registrado:</strong> {{ user.created_at|date:"d/m/Y H:i" }}
        </p>
        <div class="user-badges">
            {% if user.is_active %}
                <span class="badge green">‚úì Activo</span>
            {% else %}
                <span class="badge red">‚úó Inactivo</span>
            {% endif %}
            
            {% if user.is_verified %}
                <span class="badge green">‚úì Verificado</span>
            {% else %}
                <span class="badge yellow">‚ö† Sin verificar</span>
            {% endif %}
            
            {% if user.is_staff %}
                <span class="badge blue">üëë Staff</span>
            {% endif %}
            
            <span class="badge gray">{{ user.provider|upper }}</span>
        </div>
    </div>
    <div>
        <a href="{% url 'admin:user_useraccount_change' user.id %}" class="button">Editar Usuario</a>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-box">
        <div class="label">LOGINS EXITOSOS</div>
        <div class="number" style="color: #28a745;">
            {{ logs|length }}
        </div>
    </div>
    
    <div class="stat-box">
        <div class="label">√öLTIMO LOGIN</div>
        <div class="number" style="color: #007bff; font-size: 16px;">
            {% if user.last_login %}
                {{ user.last_login|date:"d/m/Y H:i" }}
            {% else %}
                Nunca
            {% endif %}
        </div>
    </div>
    
    <div class="stat-box">
        <div class="label">EVENTOS (7 D√çAS)</div>
        <div class="number" style="color: #ffc107;">
            {{ logs|length }}
        </div>
    </div>
</div>

<div class="activity-log">
    <div style="padding: 20px; border-bottom: 2px solid #ddd;">
        <h2 style="margin: 0;">Historial de Actividad (√∫ltimos 100 eventos)</h2>
    </div>
    
    {% for log in logs %}
    <div class="log-entry">
        <div class="log-icon {% if log.success %}success{% else %}failed{% endif %}">
            {% if log.success %}‚úì{% else %}‚úó{% endif %}
        </div>
        
        <div>
            <div class="log-event">
                {% if log.event_type == 'login' %}
                    üîì Login
                {% elif log.event_type == 'logout' %}
                    üîí Logout
                {% elif log.event_type == 'login_failed' %}
                    ‚ö†Ô∏è Login Fallido
                {% elif log.event_type == 'register' %}
                    ‚ú® Registro
                {% elif log.event_type == 'password_reset' %}
                    üîë Reset Password
                {% elif log.event_type == 'password_change' %}
                    üîê Cambio Password
                {% elif log.event_type == 'email_verify' %}
                    ‚úâÔ∏è Email Verificado
                {% elif log.event_type == '2fa_verify' %}
                    üîê 2FA Verificado
                {% elif log.event_type == '2fa_failed' %}
                    ‚ö†Ô∏è 2FA Fallido
                {% else %}
                    üìù {{ log.event_type }}
                {% endif %}
            </div>
        </div>
        
        <div class="log-details">
            <strong>IP:</strong> {{ log.ip_address }}<br>
            {% if log.details %}
                <small>{{ log.details }}</small>
            {% endif %}
        </div>
        
        <div class="log-time">
            {{ log.timestamp|date:"d/m/Y" }}<br>
            <strong>{{ log.timestamp|date:"H:i:s" }}</strong>
        </div>
    </div>
    {% empty %}
    <div style="padding: 40px; text-align: center; color: #999;">
        <p>No hay actividad registrada para este usuario.</p>
    </div>
    {% endfor %}
</div>

<div style="margin: 30px 0;">
    <a href="{% url 'admin:user_useraccount_changelist' %}" class="button">‚Üê Volver a Usuarios</a>
    <a href="{% url 'admin:user_analytics' %}" class="button" style="margin-left: 10px;">Ver Anal√≠ticas</a>
</div>

{% endblock %}
