# üìö DOCUMENTACI√ìN COMPLETA - SISTEMA DE MEN√öS Y P√ÅGINAS

## üìñ √çndice

1. [Resumen General](#resumen-general)
2. [Instalaci√≥n](#instalaci√≥n)
3. [Modelo Menu](#modelo-menu)
4. [Modelo Page](#modelo-page)
5. [API Endpoints](#api-endpoints)
6. [Ejemplos de Uso](#ejemplos-de-uso)
7. [Admin](#admin)
8. [Frontend Integration](#frontend-integration)

---

## üéØ Resumen General

Sistema completo de **Men√∫s Jer√°rquicos** y **P√°ginas Est√°ticas** para Django, inspirado en WordPress pero mejorado.

### Caracter√≠sticas Principales

#### üîó Sistema de Men√∫s
- ‚úÖ Men√∫s jer√°rquicos ilimitados (MPTT)
- ‚úÖ M√∫ltiples tipos (Header, Footer, Mobile, Sidebar)
- ‚úÖ Enlaces flexibles (URL, Categor√≠a, P√°gina, Externo, Mega Men√∫)
- ‚úÖ Drag & Drop en admin
- ‚úÖ Iconos y clases CSS personalizadas
- ‚úÖ Mega men√∫s con columnas
- ‚úÖ API completa con √°rbol jer√°rquico

#### üìÑ Sistema de P√°ginas
- ‚úÖ P√°ginas est√°ticas (Privacidad, T√©rminos, Ayuda, etc)
- ‚úÖ Editor WYSIWYG (TinyMCE)
- ‚úÖ M√∫ltiples plantillas
- ‚úÖ SEO completo (meta tags)
- ‚úÖ Programaci√≥n de publicaci√≥n
- ‚úÖ P√°ginas protegidas por autenticaci√≥n
- ‚úÖ Tiempo de lectura estimado

---

## üöÄ Instalaci√≥n

### Paso 1: Verificar Dependencias

```bash
# Aseg√∫rate de tener instalado:
pip install django-mptt
pip install django-tinymce
pip install easy-thumbnails
```

### Paso 2: Copiar Archivos

```cmd
REM Copiar modelos actualizados
copy configuration_models.py core\configuration\models.py

REM Copiar admin actualizado
copy configuration_admin.py core\configuration\admin.py

REM Copiar endpoints actualizados
copy configuration_endpoints.py core\configuration\api\endpoints.py

REM Copiar schemas actualizados
copy configuration_schemas.py core\configuration\api\schemas.py
```

### Paso 3: Configurar TinyMCE

En `settings.py`:

```python
INSTALLED_APPS = [
    # ...
    'mptt',
    'tinymce',
    'easy_thumbnails',
    'core.configuration',
    # ...
]

# Configuraci√≥n de TinyMCE
TINYMCE_DEFAULT_CONFIG = {
    'height': 500,
    'width': '100%',
    'cleanup_on_startup': True,
    'custom_undo_redo_levels': 20,
    'selector': 'textarea',
    'theme': 'silver',
    'plugins': '''
        textcolor save link image media preview codesample contextmenu
        table code lists fullscreen  insertdatetime  nonbreaking
        contextmenu directionality searchreplace wordcount visualblocks
        visualchars code fullscreen autolink lists charmap print hr
        anchor pagebreak
    ''',
    'toolbar1': '''
        fullscreen preview bold italic underline | fontselect,
        fontsizeselect  | forecolor backcolor | alignleft alignright |
        aligncenter alignjustify | indent outdent | bullist numlist table |
        | link image media | codesample |
    ''',
    'toolbar2': '''
        visualblocks visualchars |
        charmap hr pagebreak nonbreaking anchor |  code |
    ''',
    'contextmenu': 'formats | link image',
    'menubar': True,
    'statusbar': True,
}
```

### Paso 4: Migraciones

```bash
python manage.py makemigrations configuration
python manage.py migrate
```

### Paso 5: Registrar en API

En tu `app/api.py`:

```python
from core.configuration.api.endpoints import router as config_router

api.add_router("/config/", config_router, tags=["Configuraci√≥n"])
```

---

## üîó Modelo Menu

### Estructura del Modelo

```python
class Menu(MPTTModel):
    # B√°sico
    name = CharField  # Texto del men√∫
    slug = SlugField  # URL amigable
    parent = TreeForeignKey  # Padre (jerarqu√≠a)
    
    # Tipo y ubicaci√≥n
    menu_type = CharField  # header, footer, mobile, sidebar, custom
    link_type = CharField  # url, category, page, external, megamenu
    
    # Enlaces
    url = CharField  # URL personalizada
    category = ForeignKey(Category)  # Enlace a categor√≠a
    page = ForeignKey(Page)  # Enlace a p√°gina
    
    # Visual
    icon = CharField  # Clase de icono
    image = ImageField  # Imagen opcional
    description = TextField  # Descripci√≥n
    css_classes = CharField  # Clases CSS
    
    # Configuraci√≥n
    order = IntegerField  # Orden
    is_active = BooleanField  # Activo/Inactivo
    is_featured = BooleanField  # Destacado
    open_in_new_tab = BooleanField  # target="_blank"
    mega_menu_columns = IntegerField  # Columnas si es mega men√∫
```

### Tipos de Men√∫ Disponibles

| Tipo | Descripci√≥n | Uso |
|------|-------------|-----|
| `header` | Men√∫ Principal | Navegaci√≥n superior |
| `footer` | Men√∫ Footer | Enlaces del pie de p√°gina |
| `mobile` | Men√∫ M√≥vil | Hamburger menu |
| `sidebar` | Men√∫ Lateral | Categor√≠as laterales |
| `custom` | Personalizado | Cualquier otro uso |

### Tipos de Enlace

| Tipo | Descripci√≥n | Ejemplo |
|------|-------------|---------|
| `url` | URL Personalizada | `/shop`, `/about` |
| `category` | Enlace a Categor√≠a | Selecciona de lista |
| `page` | Enlace a P√°gina | Selecciona de lista |
| `external` | Enlace Externo | `https://google.com` |
| `megamenu` | Mega Men√∫ | Solo contenedor |

### M√©todos Principales

```python
menu = Menu.objects.get(id=1)

# Obtener URL final
url = menu.get_url()  # Retorna URL seg√∫n tipo

# Verificar hijos
has_children = menu.has_children()  # True/False

# Obtener hijos activos
children = menu.get_active_children()

# Obtener clases CSS como lista
classes = menu.get_css_classes_list()

# URL de imagen
image_url = menu.image_url  # Property
```

### Validaciones Autom√°ticas

‚úÖ Valida que URL est√© presente si `link_type='url'`  
‚úÖ Valida que categor√≠a est√© seleccionada si `link_type='category'`  
‚úÖ Valida que p√°gina est√© seleccionada si `link_type='page'`  
‚úÖ Auto-genera slug √∫nico del nombre  

---

## üìÑ Modelo Page

### Estructura del Modelo

```python
class Page(models.Model):
    # B√°sico
    title = CharField  # T√≠tulo
    slug = SlugField  # URL amigable
    
    # Tipo y plantilla
    page_type = CharField  # legal, about, help, policy, custom
    template = CharField  # default, full_width, sidebar, landing, contact
    
    # Contenido
    content = HTMLField  # Contenido HTML (TinyMCE)
    excerpt = TextField  # Resumen corto
    featured_image = ImageField  # Imagen destacada
    
    # SEO
    meta_title = CharField  # T√≠tulo SEO (70 chars)
    meta_description = CharField  # Descripci√≥n SEO (160 chars)
    meta_keywords = CharField  # Keywords
    
    # Configuraci√≥n
    is_published = BooleanField  # Publicado
    show_in_menu = BooleanField  # Mostrar en men√∫s
    require_auth = BooleanField  # Requiere login
    order = IntegerField  # Orden
    published_at = DateTimeField  # Fecha de publicaci√≥n
```

### Tipos de P√°gina

| Tipo | Descripci√≥n | Ejemplos |
|------|-------------|----------|
| `legal` | Legal | Privacidad, T√©rminos |
| `about` | Institucional | Sobre Nosotros, Equipo |
| `help` | Ayuda/Soporte | FAQ, Gu√≠as |
| `policy` | Pol√≠ticas | Devoluciones, Env√≠os |
| `custom` | Personalizada | Cualquier otra |

### Plantillas Disponibles

| Plantilla | Descripci√≥n |
|-----------|-------------|
| `default` | Plantilla est√°ndar |
| `full_width` | Ancho completo sin sidebar |
| `sidebar` | Con barra lateral |
| `landing` | Landing page especial |
| `contact` | P√°gina de contacto |

### M√©todos Principales

```python
page = Page.objects.get(id=1)

# Verificar si est√° publicada
is_published = page.is_currently_published()

# URL de la p√°gina
url = page.get_absolute_url()  # /page/slug

# Tiempo de lectura
reading_time = page.get_reading_time()  # En minutos

# URL de imagen
image_url = page.featured_image_url  # Property
```

### Auto-generaci√≥n de Campos

‚úÖ Auto-genera `slug` del t√≠tulo  
‚úÖ Auto-genera `meta_title` del t√≠tulo (si vac√≠o)  
‚úÖ Auto-genera `meta_description` del excerpt (si vac√≠o)  
‚úÖ Auto-establece `published_at` al publicar por primera vez  

---

## üåê API Endpoints

### Endpoints de Menu

#### 1. Listar Men√∫s

```http
GET /api/config/menus/list

Query Parameters:
- menu_type: header, footer, mobile, sidebar, custom
- is_active: true/false
- search: Buscar texto
```

**Ejemplo:**
```bash
GET /api/config/menus/list?menu_type=header&is_active=true
```

**Respuesta:**
```json
[
  {
    "id": 1,
    "name": "Home",
    "slug": "home",
    "menu_type": "header",
    "url": "/",
    "icon": "fa-home",
    "order": 0,
    "level": 0,
    "is_active": true
  }
]
```

---

#### 2. Obtener √Årbol de Men√∫

```http
GET /api/config/menus/tree/{menu_type}
```

**Ejemplo:**
```bash
GET /api/config/menus/tree/header
```

**Respuesta:**
```json
[
  {
    "id": 1,
    "name": "Shop",
    "slug": "shop",
    "url": "/shop",
    "icon": "fa-shopping-bag",
    "is_featured": false,
    "level": 0,
    "children": [
      {
        "id": 2,
        "name": "Categor√≠as",
        "slug": "categorias",
        "url": "/categorias",
        "icon": null,
        "is_featured": false,
        "level": 1,
        "children": []
      }
    ]
  }
]
```

---

#### 3. Obtener Men√∫ por ID/Slug

```http
GET /api/config/menus/{menu_id}
GET /api/config/menus/slug/{slug}
```

**Ejemplo:**
```bash
GET /api/config/menus/1
GET /api/config/menus/slug/shop-now
```

---

### Endpoints de Page

#### 1. Listar P√°ginas

```http
GET /api/config/pages/list

Query Parameters:
- page_type: legal, about, help, policy, custom
- is_published: true/false
- search: Buscar texto
```

**Ejemplo:**
```bash
GET /api/config/pages/list?page_type=legal
```

**Respuesta:**
```json
[
  {
    "id": 1,
    "title": "Pol√≠tica de Privacidad",
    "slug": "politica-de-privacidad",
    "page_type": "legal",
    "page_type_display": "Legal",
    "excerpt": "Lee nuestra pol√≠tica de privacidad...",
    "featured_image_url": null,
    "is_published": true,
    "published_at": "2024-01-15T10:00:00Z",
    "reading_time": 5
  }
]
```

---

#### 2. Obtener P√°gina por ID/Slug

```http
GET /api/config/pages/{page_id}
GET /api/config/pages/slug/{slug}
```

**Ejemplo:**
```bash
GET /api/config/pages/slug/politica-de-privacidad
```

**Respuesta:**
```json
{
  "id": 1,
  "title": "Pol√≠tica de Privacidad",
  "slug": "politica-de-privacidad",
  "page_type": "legal",
  "template": "default",
  "content": "<h1>Pol√≠tica de Privacidad</h1><p>...</p>",
  "excerpt": "Lee nuestra pol√≠tica...",
  "meta_title": "Pol√≠tica de Privacidad - Mi Tienda",
  "meta_description": "Lee nuestra pol√≠tica de privacidad...",
  "is_published": true,
  "reading_time": 5,
  "absolute_url": "/page/politica-de-privacidad"
}
```

---

#### 3. P√°ginas para Footer

```http
GET /api/config/pages/menu/footer
```

Retorna solo p√°ginas marcadas como "mostrar en men√∫".

**Uso:** Links de Privacidad, T√©rminos en el footer.

---

#### 4. Configuraci√≥n Completa del Sitio

```http
GET /api/config/site
```

Retorna todo en una sola llamada:
- Men√∫s de todos los tipos
- P√°ginas para footer
- Estad√≠sticas

**Respuesta:**
```json
{
  "menus": {
    "header": [...],
    "footer": [...],
    "mobile": [...]
  },
  "footer_pages": [
    {
      "id": 1,
      "title": "Privacidad",
      "slug": "privacidad",
      "page_type": "legal"
    }
  ],
  "stats": {
    "total_menus": 10,
    "total_pages": 5
  }
}
```

---

## üí° Ejemplos de Uso

### Ejemplo 1: Men√∫ de Navegaci√≥n Principal

```javascript
// React/Next.js Component

async function loadMainMenu() {
  const response = await fetch('/api/config/menus/tree/header');
  const menus = await response.json();
  
  return menus;
}

function NavigationMenu() {
  const [menus, setMenus] = useState([]);
  
  useEffect(() => {
    loadMainMenu().then(setMenus);
  }, []);
  
  const renderMenu = (items) => (
    <ul>
      {items.map(item => (
        <li key={item.id}>
          <a href={item.url}>
            {item.icon && <i className={item.icon} />}
            {item.name}
          </a>
          {item.children.length > 0 && (
            <ul className="submenu">
              {renderMenu(item.children)}
            </ul>
          )}
        </li>
      ))}
    </ul>
  );
  
  return <nav>{renderMenu(menus)}</nav>;
}
```

---

### Ejemplo 2: Footer con Links Legales

```javascript
async function loadFooterPages() {
  const response = await fetch('/api/config/pages/menu/footer');
  const pages = await response.json();
  
  return pages;
}

function Footer() {
  const [pages, setPages] = useState([]);
  
  useEffect(() => {
    loadFooterPages().then(setPages);
  }, []);
  
  return (
    <footer>
      <div className="legal-links">
        {pages.map(page => (
          <a key={page.id} href={`/page/${page.slug}`}>
            {page.title}
          </a>
        ))}
      </div>
    </footer>
  );
}
```

---

### Ejemplo 3: Renderizar P√°gina

```javascript
async function loadPage(slug) {
  const response = await fetch(`/api/config/pages/slug/${slug}`);
  const page = await response.json();
  
  return page;
}

function PageComponent({ slug }) {
  const [page, setPage] = useState(null);
  
  useEffect(() => {
    loadPage(slug).then(setPage);
  }, [slug]);
  
  if (!page) return <div>Cargando...</div>;
  
  return (
    <article>
      <h1>{page.title}</h1>
      
      {page.featured_image_url && (
        <img src={page.featured_image_url} alt={page.title} />
      )}
      
      <div 
        className="content"
        dangerouslySetInnerHTML={{ __html: page.content }}
      />
      
      <footer>
        <small>Tiempo de lectura: {page.reading_time} min</small>
      </footer>
    </article>
  );
}
```

---

### Ejemplo 4: SEO Meta Tags

```javascript
async function loadPageSEO(slug) {
  const response = await fetch(`/api/config/pages/seo/${slug}`);
  const seo = await response.json();
  
  return seo;
}

function PageHead({ slug }) {
  const [seo, setSeo] = useState(null);
  
  useEffect(() => {
    loadPageSEO(slug).then(setSeo);
  }, [slug]);
  
  if (!seo) return null;
  
  return (
    <Head>
      <title>{seo.meta_title}</title>
      <meta name="description" content={seo.meta_description} />
      {seo.meta_keywords && (
        <meta name="keywords" content={seo.meta_keywords} />
      )}
      <link rel="canonical" href={`https://ejemplo.com${seo.absolute_url}`} />
    </Head>
  );
}
```

---

## üé® Admin

### Caracter√≠sticas del Admin de Menu

1. **Drag & Drop** - Reorganizar arrastrando
2. **Preview de URL** - Ver URL final antes de guardar
3. **Badges de Tipo** - Colores por tipo de men√∫
4. **Validaciones** - No permitir configuraciones inv√°lidas
5. **Duplicar** - Acci√≥n para duplicar men√∫s
6. **Activar/Desactivar** - Acciones masivas

### Caracter√≠sticas del Admin de Page

1. **Editor WYSIWYG** - TinyMCE completo
2. **Preview SEO** - Ver c√≥mo se ver√° en Google
3. **Tiempo de Lectura** - C√°lculo autom√°tico
4. **Programar Publicaci√≥n** - Fechas futuras
5. **Preview de Imagen** - Vista previa grande
6. **Duplicar** - Acci√≥n para duplicar p√°ginas

---

## ‚úÖ Checklist de Implementaci√≥n

- [ ] Dependencias instaladas (mppt, tinymce)
- [ ] Archivos copiados
- [ ] Migraciones ejecutadas
- [ ] Router registrado en API
- [ ] TinyMCE configurado
- [ ] Crear men√∫s de prueba
- [ ] Crear p√°ginas de prueba
- [ ] Probar endpoints
- [ ] Integrar en frontend

---

## üéì Mejores Pr√°cticas

### Para Men√∫s

1. ‚úÖ Usa `menu_type` apropiado para cada ubicaci√≥n
2. ‚úÖ No crear m√°s de 3 niveles de profundidad
3. ‚úÖ Usa iconos consistentes (FontAwesome, Lucide, etc)
4. ‚úÖ Mant√©n nombres cortos (m√°x 20 caracteres)
5. ‚úÖ Usa `is_featured` para destacar items importantes

### Para P√°ginas

1. ‚úÖ Escribe meta descriptions √∫nicas (m√°x 160 chars)
2. ‚úÖ Usa headings jer√°rquicos (H1, H2, H3)
3. ‚úÖ Optimiza im√°genes antes de subir
4. ‚úÖ Marca como "mostrar en men√∫" solo las esenciales
5. ‚úÖ Usa extractos atractivos

---

## üìä Resumen de Archivos

| Archivo | Descripci√≥n | L√≠neas |
|---------|-------------|--------|
| `models.py` | Modelos Menu y Page | ~800 |
| `admin.py` | Admin completo | ~500 |
| `endpoints.py` | 20+ endpoints API | ~500 |
| `schemas.py` | Schemas Ninja | ~200 |

**Total:** ~2,000 l√≠neas de c√≥digo profesional

---

**¬øNecesitas algo m√°s espec√≠fico?**
- Agregar m√°s tipos de p√°gina
- Crear templates personalizados
- Integraci√≥n con redes sociales
- Sistema de comentarios

¬°Ya tienes un CMS completo integrado! üöÄ